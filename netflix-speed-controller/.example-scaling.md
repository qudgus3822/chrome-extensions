# Extension 확장 예시

## 1. Background Service Worker 추가하기

### src/background.ts 생성
```typescript
// Background service worker
chrome.runtime.onInstalled.addListener(() => {
  console.log("Extension installed");
  chrome.storage.sync.set({ isEnabled: false });
});

// 메시지 처리
chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
  if (request.action === "trackUsage") {
    // 사용 통계 기록
  }
});
```

### vite.config.ts 수정
```typescript
export default defineConfig({
  build: {
    rollupOptions: {
      input: {
        content: resolve(__dirname, "src/content.ts"),
        popup: resolve(__dirname, "src/popup.ts"),
        background: resolve(__dirname, "src/background.ts"),  // 추가
      },
      output: {
        entryFileNames: "[name].js",
        format: "es",
      },
    },
  },
});
```

### manifest.json 수정
```json
{
  "background": {
    "service_worker": "dist/background.js"
  }
}
```

## 2. Options Page 추가

### src/options.ts 생성
```typescript
// 설정 페이지 로직
const speedInput = document.getElementById("speed") as HTMLInputElement;

chrome.storage.sync.get(["customSpeed"], (result) => {
  speedInput.value = result.customSpeed || "2.0";
});
```

### vite.config.ts에 추가
```typescript
input: {
  content: resolve(__dirname, "src/content.ts"),
  popup: resolve(__dirname, "src/popup.ts"),
  background: resolve(__dirname, "src/background.ts"),
  options: resolve(__dirname, "src/options.ts"),  // 추가
}
```

## 3. 여러 Content Script

```typescript
input: {
  'content-netflix': resolve(__dirname, "src/content-netflix.ts"),
  'content-youtube': resolve(__dirname, "src/content-youtube.ts"),
  'content-common': resolve(__dirname, "src/content-common.ts"),
  popup: resolve(__dirname, "src/popup.ts"),
  background: resolve(__dirname, "src/background.ts"),
}
```

## 4. 공통 모듈 분리

```typescript
// src/utils/video-controller.ts
export class VideoController {
  setSpeed(speed: number) { }
  findVideo() { }
}

// src/content.ts
import { VideoController } from './utils/video-controller';
```

Vite가 자동으로 공통 코드를 chunk로 분리합니다!

## 5. 외부 라이브러리 사용

```typescript
// 예: Lodash 사용
import _ from 'lodash';

// vite.config.ts에서 externals 설정 가능
rollupOptions: {
  external: ['chrome'],  // chrome API는 번들에 포함 안 함
}
```

## Library 모드였다면?

❌ 모든 코드가 하나의 파일로 번들됨
❌ content/popup/background를 분리할 수 없음
❌ 각 스크립트마다 별도 빌드 설정 필요
❌ 수동으로 파일 분리 작업 필요

## 현재 구조의 장점

✅ 파일 추가만 하면 자동으로 빌드됨
✅ 코드 스플리팅 자동 처리
✅ Tree-shaking으로 불필요한 코드 제거
✅ Source map 지원
✅ Hot Module Replacement (개발 모드)
